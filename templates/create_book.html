
<!--TODO: split code  into create and edit templates-->
  <form method="{{method}}" action="{{ url_for('user_route.create_book') }}" enctype="multipart/form-data">
    <div class="form-group">
        <label for="title">Title</label>
        <input type="text" class="form-control" id="title" name="title" required value=" {% if book %}{{  book.title }} {% endif %} " >
    </div>
    <div class="form-group">
        <label for="author">Author</label>
        <input type="text" class="form-control" id="author" name="author" value="{% if book %}{{ book.author }}{% endif %}" required>
    </div>
    <div class="form-group">
        <label for="image">Image</label>
        <input type="file" class="form-control" id="image" name="image" accept="image/*" onchange="previewImage(event)" >
        <img id="imagePreview" src="{% if book %}{{ book.img_url }}{% endif %}" alt="Image Preview" style=" {% if flag=='create' %}display:none;{% endif %}  margin-top: 10px; max-width: 100%; height: auto;">
    </div>
    <div class="form-group">
        <label for="description">Description</label>
        <textarea class="form-control" id="description" name="description">{% if book %}{{ book.description }}{% endif %}</textarea>
    </div>
    <div class="form-group">
        <label for="genre_id">Genre ID</label>
      
       <select class="form-select" id="genre" name="genre" value="{% if book %}{{ book.genre_id }}{% endif %}" >
        <option value="" disabled selected={{ flag=='create'}}>Select genre</option>
        {% for genre in genres %}
        <option value="{{ genre.id }}"{% if book %} {% if book.genre_id == genre.id %}selected{% endif %}{% endif %}>{{ genre.name }}</option>

        {% endfor %}

    </select>
    </div>
    <button type="submit" class="btn btn-primary">Save Book</button>
    {% if flag=='edit' %}
    <button type="button" class="btn btn-danger" onclick="deleteBook({{ book.id }})">Delete Book</button>
    {% endif %}
    <button type="button" class="btn btn-secondary" onclick="window.history.back()">Cancel</button>
</form>

<script>
    function previewImage(event) {
        const file = event.target.files[0]; 
        const reader = new FileReader(); 
    
        reader.onload = function() {
            const imagePreview = document.getElementById('imagePreview'); 
            imagePreview.src = reader.result; 
            imagePreview.style.display = 'block';
        };
    
        if (file) {
            reader.readAsDataURL(file); 
        }
    }
    </script>
    <script>
        function deleteBook(bookId) {
            if (confirm("Are you sure you want to delete this book?")) {
                fetch(`/api/v1/books/${bookId}`, {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json',
                        // Add any necessary authentication headers here
                    }
                })
                .then(response => {
                    if (response.ok) {
                        alert("Book deleted successfully.");
                        // Optionally, redirect or refresh the page
                        window.location.href = "/"; 
                    } else {
                        alert("Failed to delete the book. Please try again.");
                    }
                })
                .catch(error => {
                    console.error("Error:", error);
                    alert("An error occurred while trying to delete the book.");
                });
            }
        }
    </script>
